<!DOCTYPE html>
<html lang="en">
<head>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="Mr. Smith">
  <meta name="keywords" content="docker, example, package installation, node, centos">

  <title>Dockerizing a Node.js web app - Mr. Smith</title>

  <link rel="icon" href="/mistersmith/images/favicon.png">
  <link rel="apple-touch-icon" href="/mistersmith/images/favicon.png">

  <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Open+Sans:300,300italic,700|Ubuntu+Condensed:400&subset=latin">
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.6/styles/tomorrow-night.min.css">
  <link rel="stylesheet" href="/mistersmith/styles/main.css">

</head>
<body data-route="docs">

  <header id="header" data-uk-sticky>

  <nav id="navbar" class="uk-navbar">
    <div class="uk-container uk-container-center">

      <a class="uk-navbar-brand uk-hidden-small" href="/mistersmith/">Mr. Smith</a>

      <ul class="uk-navbar-nav uk-hidden-small">
        
        
        <li >
          <a href="/mistersmith/">Home</a>
        </li>
        
        
        
        <li  data-uk-dropdown="{mode: 'click'}">
          <a>Docs <span class="uk-icon-caret-down"></span></a>
          <div class="uk-dropdown ul-dropdown-navbar">
            <ul class="uk-nav uk-nav-navbar">
              
              <li >
                <a href="/mistersmith/docs/">Introduction</a>
              </li>
              
              <li >
                <a href="/mistersmith/docs/docker/">Docker</a>
              </li>
              
              <li class="uk-active">
                <a href="/mistersmith/docs/nodejs/">Nodejs</a>
              </li>
              
            </ul>
          </div>
        </li>
        
        
        
        <li >
          <a href="/mistersmith/blog/">Blog</a>
        </li>
        
        
      </ul>

      <ul class="uk-navbar-nav uk-navbar-flip uk-hidden-small">
        <li><a href=""><span class="uk-icon-search"></span> Search</a></li>
        <li ><a href="/mistersmith/docs/docker/"><span class="uk-icon-arrow-left"></span> Prev</a></li>
        <li ><a href="/mistersmith/blog/">Next <span class="uk-icon-arrow-right"></span></a></li>
        <li><a href="//github.com/roll/mistersmith"><span class="uk-icon-github"></span> Github</a></li>
      </ul>

      <a href="#menu" class="uk-navbar-toggle uk-visible-small" data-uk-offcanvas></a>
      <div class="uk-navbar-brand uk-navbar-center uk-visible-small">Mr. Smith</div>

    </div>
  </nav>

</header>


  
<div class="uk-container uk-margin-top">

  <div class="uk-grid">
    <div class="uk-width-medium-2-10"></div>
    <div class="uk-width-medium-8-10"><h1 id="dockerizing-a-node-js-web-app">Dockerizing a Node.js web app <a class="heading-anchor" href="#dockerizing-a-node-js-web-app"><span class="uk-icon-link"></span></a></h1>
<blockquote>
<p><strong>Note</strong>:</p>
<ul>
<li><strong>If you don&apos;t like sudo</strong> then see <a href="/installation/binaries/#giving-non-root-access"><em>Giving non-root
access</em></a></li>
</ul>
</blockquote>
<p>The goal of this example is to show you how you can build your own
Docker images from a parent image using a <code>Dockerfile</code>
. We will do that by making a simple Node.js hello world web
application running on CentOS. You can get the full source code at
<a href="https://github.com/enokd/docker-node-hello/">https://github.com/enokd/docker-node-hello/</a>.</p>
<h2 id="create-node-js-app">Create Node.js app <a class="heading-anchor" href="#create-node-js-app"><span class="uk-icon-link"></span></a></h2>
<p>First, create a directory <code>src</code> where all the files
would live. Then create a <code>package.json</code> file that
describes your app and its dependencies:</p>
<pre><code class="hljs json">{
  &quot;<span class="hljs-attribute">name</span>&quot;: <span class="hljs-value"><span class="hljs-string">&quot;docker-centos-hello&quot;</span></span>,
  &quot;<span class="hljs-attribute">private</span>&quot;: <span class="hljs-value"><span class="hljs-literal">true</span></span>,
  &quot;<span class="hljs-attribute">version</span>&quot;: <span class="hljs-value"><span class="hljs-string">&quot;0.0.1&quot;</span></span>,
  &quot;<span class="hljs-attribute">description</span>&quot;: <span class="hljs-value"><span class="hljs-string">&quot;Node.js Hello world app on CentOS using docker&quot;</span></span>,
  &quot;<span class="hljs-attribute">author</span>&quot;: <span class="hljs-value"><span class="hljs-string">&quot;Daniel Gasienica &lt;daniel@gasienica.ch&gt;&quot;</span></span>,
  &quot;<span class="hljs-attribute">dependencies</span>&quot;: <span class="hljs-value">{
    &quot;<span class="hljs-attribute">express</span>&quot;: <span class="hljs-value"><span class="hljs-string">&quot;3.2.4&quot;</span>
  </span>}
</span>}</code></pre>

<p>Then, create an <code>index.js</code> file that defines a web
app using the <a href="http://expressjs.com/">Express.js</a> framework:</p>
<pre><code class="hljs javascript"><span class="hljs-keyword">var</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">&apos;express&apos;</span>);

<span class="hljs-comment">// Constants</span>
<span class="hljs-keyword">var</span> PORT = <span class="hljs-number">8080</span>;

<span class="hljs-comment">// App</span>
<span class="hljs-keyword">var</span> app = express();
app.get(<span class="hljs-string">&apos;/&apos;</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(req, res)</span> </span>{
  res.send(<span class="hljs-string">&apos;Hello world\n&apos;</span>);
});

app.listen(PORT);
<span class="hljs-built_in">console</span>.log(<span class="hljs-string">&apos;Running on http://localhost:&apos;</span> + PORT);</code></pre>

<p>In the next steps, we&apos;ll look at how you can run this app inside a
CentOS container using Docker. First, you&apos;ll need to build a Docker
image of your app.</p>
<h2 id="creating-a-dockerfile">Creating a Dockerfile <a class="heading-anchor" href="#creating-a-dockerfile"><span class="uk-icon-link"></span></a></h2>
<p>Create an empty file called <code>Dockerfile</code>:</p>
<pre><code class="hljs bash">touch Dockerfile</code></pre>

<p>Open the <code>Dockerfile</code> in your favorite text editor</p>
<p>Define the parent image you want to use to build your own image on
top of. Here, we&apos;ll use
<a href="https://registry.hub.docker.com/_/centos/">CentOS</a> (tag: <code>centos6</code>)
available on the <a href="https://hub.docker.com/">Docker Hub</a>:</p>
<pre><code class="hljs"><span class="hljs-tag">FROM</span>    <span class="hljs-tag">centos</span><span class="hljs-pseudo">:centos6</span></code></pre>

<p>Since we&apos;re building a Node.js app, you&apos;ll have to install Node.js as
well as npm on your CentOS image. Node.js is required to run your app
and npm to install your app&apos;s dependencies defined in
<code>package.json</code>. To install the right package for
CentOS, we&apos;ll use the instructions from the <a href="https://github.com/joyent/node/wiki/Installing-Node.js-
via-package-manager#rhelcentosscientific-linux-6">Node.js wiki</a>:</p>
<pre><code class="hljs"><span class="hljs-preprocessor"># Enable EPEL for Node.js</span>
RUN     rpm -Uvh http:<span class="hljs-comment">//download.fedoraproject.org/pub/epel/6/i386/epel-release-6-8.noarch.rpm</span>
<span class="hljs-preprocessor"># Install Node.js and npm</span>
RUN     yum install -y npm</code></pre>

<p>To bundle your app&apos;s source code inside the Docker image, use the <code>COPY</code>
instruction:</p>
<pre><code class="hljs"># Bundle app <span class="hljs-keyword">source</span>
<span class="hljs-keyword">COPY</span> . <span class="hljs-regexp">/src</span></code></pre>

<p>Install your app dependencies using the <code>npm</code> binary:</p>
<pre><code class="hljs"><span class="hljs-comment"># Install app dependencies</span>
<span class="hljs-title">RUN</span> cd /src; <span class="hljs-title">npm</span> install</code></pre>

<p>Your app binds to port <code>8080</code> so you&apos;ll use the<code>EXPOSE</code> instruction to have
it mapped by the <code>docker</code> daemon:</p>
<pre><code class="hljs"><span class="hljs-title">EXPOSE</span>  <span class="hljs-number">8080</span></code></pre>

<p>Last but not least, define the command to run your app using <code>CMD</code> which
defines your runtime, i.e. <code>node</code>, and the path to our app, i.e. <code>src/index.js</code>
(see the step where we added the source to the container):</p>
<pre><code class="hljs"><span class="hljs-title">CMD</span> [<span class="hljs-string">&quot;node&quot;</span>, <span class="hljs-string">&quot;/src/index.js&quot;</span>]</code></pre>

<p>Your <code>Dockerfile</code> should now look like this:</p>
<pre><code class="hljs">FROM    centos:centos6

<span class="hljs-preprocessor"># Enable EPEL for Node.js</span>
RUN     rpm -Uvh http:<span class="hljs-comment">//download.fedoraproject.org/pub/epel/6/i386/epel-release-6-8.noarch.rpm</span>
<span class="hljs-preprocessor"># Install Node.js and npm</span>
RUN     yum install -y npm

<span class="hljs-preprocessor"># Bundle app source</span>
COPY . /src
<span class="hljs-preprocessor"># Install app dependencies</span>
RUN cd /src; npm install

EXPOSE  <span class="hljs-number">8080</span>
CMD [<span class="hljs-string">&quot;node&quot;</span>, <span class="hljs-string">&quot;/src/index.js&quot;</span>]</code></pre>

<h2 id="building-your-image">Building your image <a class="heading-anchor" href="#building-your-image"><span class="uk-icon-link"></span></a></h2>
<p>Go to the directory that has your <code>Dockerfile</code> and run the following command
to build a Docker image. The <code>-t</code> flag lets you tag your image so it&apos;s easier
to find later using the <code>docker images</code> command:</p>
<pre><code class="hljs"><span class="hljs-prompt">$ docker build -t &lt;your username&gt;</span>/centos-node-hello .</code></pre>

<p>Your image will now be listed by Docker:</p>
<pre><code class="hljs"><span class="hljs-variable">$ </span>docker images

<span class="hljs-comment"># Example</span>
<span class="hljs-constant">REPOSITORY</span>                          <span class="hljs-constant">TAG</span>        <span class="hljs-constant">ID</span>              <span class="hljs-constant">CREATED</span>
centos                              centos6    <span class="hljs-number">539</span>c0211cd76    <span class="hljs-number">8</span> weeks ago
<span class="hljs-prompt">&lt;your username&gt;</span>/centos-node-hello   latest     d64d3505b0d2    <span class="hljs-number">2</span> hours ago</code></pre>

<h2 id="run-the-image">Run the image <a class="heading-anchor" href="#run-the-image"><span class="uk-icon-link"></span></a></h2>
<p>Running your image with <code>-d</code> runs the container in detached mode, leaving the
container running in the background. The <code>-p</code> flag redirects a public port to
a private port in the container. Run the image you previously built:</p>
<pre><code class="hljs"><span class="hljs-prompt">$ docker run -p 49160:8080 -d &lt;your username&gt;</span>/centos-node-hello</code></pre>

<p>Print the output of your app:</p>
<pre><code class="hljs"><span class="hljs-preprocessor"># Get container ID</span>
$ docker ps

<span class="hljs-preprocessor"># Print app output</span>
$ docker logs &lt;container id&gt;

<span class="hljs-preprocessor"># Example</span>
Running on http:<span class="hljs-comment">//localhost:8080</span></code></pre>

<h2 id="test">Test <a class="heading-anchor" href="#test"><span class="uk-icon-link"></span></a></h2>
<p>To test your app, get the port of your app that Docker mapped:</p>
<pre><code class="hljs">$ docker ps

<span class="hljs-comment"># Example</span>
ID            IMAGE                                     COMMAND              <span class="hljs-keyword">...</span>   PORTS
ecce33b30ebf  &lt;your username&gt;/centos-node-hello:latest  node /src/index.js         <span class="hljs-number">49160</span>-&gt;<span class="hljs-number">8080</span></code></pre>

<p>In the example above, Docker mapped the <code>8080</code> port of the container to <code>49160</code>.</p>
<p>Now you can call your app using <code>curl</code> (install if needed via:
<code>sudo apt-get install curl</code>):</p>
<pre><code class="hljs">$ curl -i <span class="hljs-string">localhost:</span><span class="hljs-number">49160</span>

HTTP/<span class="hljs-number">1.1</span> <span class="hljs-number">200</span> OK
X-Powered-<span class="hljs-string">By:</span> Express
Content-<span class="hljs-string">Type:</span> text/html; charset=utf-<span class="hljs-number">8</span>
Content-<span class="hljs-string">Length:</span> <span class="hljs-number">12</span>
<span class="hljs-string">Date:</span> Sun, <span class="hljs-number">02</span> Jun <span class="hljs-number">2013</span> <span class="hljs-number">03</span>:<span class="hljs-number">53</span>:<span class="hljs-number">22</span> GMT
<span class="hljs-string">Connection:</span> keep-alive

Hello world</code></pre>

<p>If you use Boot2docker on OS X, the port is actually mapped to the Docker host VM,
and you should use the following command:</p>
<pre><code class="hljs"><span class="hljs-variable">$ </span>curl <span class="hljs-variable">$(</span>boot2docker ip)<span class="hljs-symbol">:</span><span class="hljs-number">49160</span></code></pre>

<p>We hope this tutorial helped you get up and running with Node.js and
CentOS on Docker. You can get the full source code at
<a href="https://github.com/enokd/docker-node-hello/">https://github.com/enokd/docker-node-hello/</a>.</p>
</div>
  </div>

</div>


  <footer id="footer">
  <div class="uk-container uk-container-center">

    <div class="uk-margin-large-top uk-margin-large-bottom">
      Footer!
    </div>

  </div>
</footer>

  <nav id="menu" class="uk-offcanvas">
  <div class="uk-offcanvas-bar">

    <ul class="uk-nav uk-nav-offcanvas">
      <li class="uk-active"><a href="/mistersmith/">Home</a></li>
      <li><a href="/mistersmith/docs/">Docs</a></li>
      <li><a href="/mistersmith/blog/">Blog</a></li>
    </ul>

  </div>
</nav>


  <script src="//code.jquery.com/jquery-2.1.4.min.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/uikit/2.20.3/js/uikit.min.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/uikit/2.20.3/js/components/sticky.min.js"></script>
  <script src="//mistersmithscripts/main.js"></script>

  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    ga('create', 'UA-XXXXX-X', 'auto');
    ga('send', 'pageview');
  </script>

</body>
</html>
